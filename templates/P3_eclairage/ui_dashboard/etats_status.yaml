# ╭────────────────────────────────────────────────────────────────────────────────────────╮
# │ TEMPLATES : SÉRIE 04_03. LUMIÈRES — ÉTATS ET ICÔNES FUSIONNÉS                          │
# ╰────────────────────────────────────────────────────────────────────────────────────────╯

- sensor:
# ┌───────────────────────────────────────────────────────────────────┐
# │ 0. APPARTEMENT (GLOBAL)                                           │
# └───────────────────────────────────────────────────────────────────┘

# --- lumiere_appartement_etat ---
    - name: "Lumière Appartement État"
      unique_id: lumiere_appartement_etat
      state: >
        {% if is_state('light.entree', 'on') and is_state('light.couloir', 'on') %}
          Allumé
        {% elif is_state('light.entree', 'off') and is_state('light.couloir', 'off') %}
          Éteint
        {% elif is_state('light.entree', 'on') and is_state('light.couloir', 'off')%}
          Entrée
        {% elif is_state('light.couloir', 'on') and is_state('light.entree', 'off')%}
          Couloir
        {% else %}
          erreur
        {% endif %}
      icon: >
        {% set s = is_state('input_select.saison', 'Hiver') %}
        {% if states('sensor.lumiere_appartement_etat') != 'Éteint' %}
          {{ 'mdi:home-floor-g' if s else 'mdi:home-check' }}
        {% else %}
          {{ 'mdi:home-outline' if s else 'mdi:home-variant-outline' }}
        {% endif %}

# ┌───────────────────────────────────────────────────────────────────┐
# │ 1. ENTRÉE                                                         │
# └───────────────────────────────────────────────────────────────────┘
# --- lumiere_entree_etat ---
    - name: "Lumière Entrée État"
      unique_id: lumiere_entree_etat
      state: "{{ 'Allumée' if is_state('light.entree', 'on') else 'Éteint' }}"
      icon: "{{ 'mdi:ceiling-light' if is_state('light.entree', 'on') else 'mdi:ceiling-light-outline' }}"

# ┌───────────────────────────────────────────────────────────────────┐
# │ 4. SALON                                                          │
# └───────────────────────────────────────────────────────────────────┘

# --- lumiere_salon_etat ---
    - name: "Lumière Salon État"
      unique_id: lumiere_salon_etat
      state: >
        {% if is_state('light.salon', 'on') and is_state('light.table', 'on') %}
          Allumé
        {% elif is_state('light.salon', 'off') and is_state('light.table', 'off') %}
          Éteint
        {% elif is_state('light.salon', 'on') and is_state('light.table', 'off') %}
          Salon
        {% elif is_state('light.salon', 'off') and is_state('light.table', 'on') %}
          Table
        {% else %}
          erreur
        {% endif %}
      icon: "{{ 'mdi:sofa' if is_state('light.salon', 'on') else ' mdi:sofa-outline' }}"

# --- lumiere_table_etat ---
    - name: "Lumière Table État"
      unique_id: lumiere_table_etat
      state: "{{ 'Allumé' if is_state('light.table', 'on') else 'Éteint' }}"
      icon: "{{ 'mdi:table-chair' if is_state('light.table', 'on') else 'mdi:table-chair ' }}"

# ┌───────────────────────────────────────────────────────────────────┐
# │ 5. CUISINE                                                        │
# └───────────────────────────────────────────────────────────────────┘

# --- lumiere_cuisine_etat ---
    - name: "Lumière Cuisine État"
      unique_id: lumiere_cuisine_etat
      state: "{{ 'Allumé' if is_state('light.cuisine', 'on') else 'Éteint' }}"
      icon: "{{ 'mdi:ceiling-light' if is_state('light.cuisine', 'on') else 'mdi:ceiling-light-outline' }}"

# ┌───────────────────────────────────────────────────────────────────┐
# │ 6. COULOIR                                                        │
# └───────────────────────────────────────────────────────────────────┘

# --- lumiere_couloir_etat ---
    - name: "Lumière Couloir État"
      unique_id: lumiere_couloir_etat
      state: "{{ 'Allumée' if is_state('light.couloir', 'on') else 'Éteint' }}"
      icon: "{{ 'mdi:ceiling-light' if is_state('light.couloir', 'on') else 'mdi:ceiling-light-outline' }}"

# ┌───────────────────────────────────────────────────────────────────┐
# │ 7. BUREAU --- Bureau ---                                          │
# └───────────────────────────────────────────────────────────────────┘

# --- lumiere_bureau_etat ---
    - name: "Lumière Bureau État"
      unique_id: lumiere_bureau_etat
      state: >
        {# 1. Définition des variables basées sur tes vraies entités #}
        {% set bureau_on = is_state('light.hue_white_lamp_bureau_1', 'on') or is_state('light.hue_white_lamp_bureau_2', 'on') %}
        {% set ecran3_off = is_state('switch.ecran_p_c_3_play_hue', 'off') %}
        {% set ecrans_pc_on = is_state('light.hue_play_1_pc_bureau', 'on') or is_state('light.hue_play_2_pc_bureau', 'on') or is_state('light.hue_play_3_pc_bureau', 'on') %}
        {% set pc_running = is_state('binary_sensor.moniteur_pc', 'on') %}

        {# 2. Logique de décision #}
        {% if ecran3_off %}
          {% if bureau_on %}
            Bureau
          {% else %}
            Éteint
          {% endif %}
        {% else %}
          {% if bureau_on and ecrans_pc_on %}
            Allumé
          {% elif bureau_on and ecrans_pc_on and pc_running %}
            Allumé
          {% elif bureau_on and not ecrans_pc_on and not pc_running %}
            Bureau
          {% elif bureau_on and not ecrans_pc_on and pc_running %}
            Bureau
          {% else %}
            Éteint
          {% endif %}
        {% endif %}
      icon: >
        {% if states('sensor.lumiere_ecran_etat') in ['Allumé', 'Bureau'] %}
          hue:flourish-alt
        {% else %}
          hue:flourish
        {% endif %}

# ┌───────────────────────────────────────────────────────────────────┐
# │ 7. BUREAU --- Écran ---                                           │
# └───────────────────────────────────────────────────────────────────┘

# --- lumiere_Écran_etat ---
    - name: "Lumière Écran État"
      unique_id: lumiere_ecran_etat
      state: >
        {% set switch_on = is_state('switch.ecran_p_c_3_play_hue', 'on') %}
        {% set bureau_on = is_state('light.hue_white_lamp_bureau_1', 'on') or is_state('light.hue_white_lamp_bureau_2', 'on') %}
        {% set play_on = is_state('light.hue_play_1_pc_bureau', 'on') or is_state('light.hue_play_2_pc_bureau', 'on') or is_state('light.hue_play_3_pc_bureau', 'on') %}
        {% set pc_running = is_state('binary_sensor.moniteur_pc', 'on') %}

        {% if not switch_on %}
          Éco.
        {% else %}
          {% if bureau_on and play_on and pc_running%}
            Allumé & Sync.
          {% elif not bureau_on and play_on and pc_running%}
            Synchro.
          {% elif bureau_on and play_on %}
            Allumé
          {% elif not bureau_on and play_on %}
            Écran
          {% else %}
            Éteint
          {% endif %}
        {% endif %}
      icon: >
        {% if states('sensor.lumiere_ecran_etat') in ['Écran', 'Allumé', 'Synchro.', 'Allumé & Sync.'] %}
          mdi:monitor-dashboard
        {% else %}
          mdi:monitor
        {% endif %}
        
# ┌───────────────────────────────────────────────────────────────────┐
# │ 7. BUREAU --- Bureau-Général ---                                  │
# └───────────────────────────────────────────────────────────────────┘

# --- bureau_etat ---
    - name: "Bureau État"
      unique_id: bureau_etat
      state: >
        {% set bureau = states('sensor.lumiere_bureau_etat') %}
        {% set ecran = states('sensor.lumiere_ecran_etat') %}
        
        {% if bureau == 'Allumé' and ecran == 'Allumé' %}
          Allumé
        {% elif bureau == 'Allumé' and ecran == 'Allumé & Sync.' %}
          AlluSync
        {% elif bureau == 'Éteint' and ecran == 'Synchro.' %}
          Synchro
        {% elif bureau == 'Bureau' and ecran == 'Éteint' %}
          Bureau
        {% elif bureau == 'Éteint' and ecran == 'Écran' %}
          Écran
        {% elif bureau == 'Bureau' and ecran == 'Éco.' %}
          Bureau
        {% elif bureau == 'Éteint' and ecran == 'Éco.' %}
          Éco.
        {% elif bureau == 'Éteint' and ecran == 'Éteint' %}
          Éteint
        {% else %}
          erreur
        {% endif %}

# ┌───────────────────────────────────────────────────────────────────┐
# │ 8. SALLE DE BAIN                                                  │
# └───────────────────────────────────────────────────────────────────┘

# --- lumiere_salle_de_bain_etat ---
    - name: "Lumière Salle de Bain État"
      unique_id: lumiere_salle_de_bain_etat
      state: "{{ 'Allumé' if is_state('light.lampe_salle_de_bain_hue', 'on') else 'Éteint' }}"
      icon: "{{ 'mdi:ceiling-light' if is_state('light.lampe_salle_de_bain_hue', 'on') else 'mdi:ceiling-light-outline' }}"

# ┌───────────────────────────────────────────────────────────────────┐
# │ 9. CHAMBRE                                                        │
# └───────────────────────────────────────────────────────────────────┘

# --- chambre_etat ---
    - name: "Chambre État"
      unique_id: chambre_etat
      state: >
        {% if is_state('switch.prise_tete_de_lit_chambre', 'off') %}
          {% if is_state('light.chambre', 'on') %}
            Chambre
          {% else %}
            Éco.
          {% endif %}
        {% else %}
          {% if is_state('light.chambre', 'on') and is_state('light.hue_color_candle_chambre_gege', 'on') and is_state('light.hue_color_candle_chambre_eric', 'on') %}
            Allumé
          {% elif is_state('light.chambre', 'on') and is_state('light.hue_color_candle_chambre_gege', 'on') and is_state('light.hue_color_candle_chambre_eric', 'off') %}
            Ch.+zG
          {% elif is_state('light.chambre', 'on') and is_state('light.hue_color_candle_chambre_gege', 'off') and is_state('light.hue_color_candle_chambre_eric', 'on') %}
            Ch.+zÉ
          {% elif is_state('light.chambre', 'on') and is_state('light.hue_color_candle_chambre_gege', 'off') and is_state('light.hue_color_candle_chambre_eric', 'off') %}
            Chambre
          {% elif is_state('light.chambre', 'off') and is_state('light.hue_color_candle_chambre_gege', 'off') and is_state('light.hue_color_candle_chambre_eric', 'off') %}
            Éteint
          {% elif is_state('light.chambre', 'off') and is_state('light.hue_color_candle_chambre_gege', 'on') and is_state('light.hue_color_candle_chambre_eric', 'off') %}
            Zone G.
          {% elif is_state('light.chambre', 'off') and is_state('light.hue_color_candle_chambre_gege', 'off') and is_state('light.hue_color_candle_chambre_eric', 'on') %}
            Zone É.
          {% elif is_state('light.chambre', 'off') and is_state('light.hue_color_candle_chambre_gege', 'on') and is_state('light.hue_color_candle_chambre_eric', 'on') %}
            Tête Lit
          {% endif %}
        {% endif %}

# --- lumiere_chambre_etat ---
    - name: "Lumière Chambre État"
      unique_id: lumiere_chambre_etat
      state: "{{ 'Allumé' if is_state('light.chambre', 'on') else 'Éteint' }}"
      icon: "{{ 'hue:flourish-alt' if is_state('light.chambre', 'on') else 'hue:flourish' }}"

# --- lumiere_tete_de_lit_etat ---
    - name: "Lumière Tête de Lit État"
      unique_id: lumiere_tete_de_lit_etat
      state: >
        {% if is_state('switch.prise_tete_de_lit_chambre', 'off') %}
            Éco.
        {% else %}
          {% set gg = is_state('light.hue_color_candle_chambre_gege', 'on') %}
          {% set er = is_state('light.hue_color_candle_chambre_eric', 'on') %}
          
          {% if gg and er %}
            Tête Lit, allumée
          {% elif gg %}
            Zone Géraldine
          {% elif er %}
            Zone Éric
          {% else %}
            Éteint
          {% endif %}
        {% endif %}
      icon: >
        {# L'icône change selon le texte généré au-dessus #}
        {% set etat = states('sensor.lumiere_tete_de_lit_etat') %}
        {% if etat in ['Éteint', 'Éco.', 'unavailable', 'unknown'] %}
          mdi:bed-outline
        {% else %}
          mdi:bed
        {% endif %}