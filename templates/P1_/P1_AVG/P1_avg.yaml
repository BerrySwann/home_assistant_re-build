# ╭────────────────────────────────────────────────────────────────────────╮
# │ P1_AVG | PUISSANCE MOYENNE (W)                                         │
# ╰────────────────────────────────────────────────────────────────────────╯

- sensor:
    # ==========================================================================
    # PÔLE 1. CHAUFFAGE / CLIM
    # ==========================================================================

    # ┌───────────────────────────────────┐
    # │ 4. SALON                          │
    # └───────────────────────────────────┘
    # --- clim_salon_avg_watts_quotidien ---
    - name: "Clim Salon Avg Watts Quotidien"
      unique_id: clim_salon_avg_watts_quotidien
      unit_of_measurement: "W"
      device_class: power
      state: >
        {% set conso = states('sensor.clim_salon_quotidien_kwh_um') | float(0) %}
        {% set h = now().hour + (now().minute / 60) %}
        {{ ((conso * 1000) / h if h > 0.1 else 0) | round(1) }}

    # --- clim_salon_avg_watts_mensuel ---
    - name: "Clim Salon Avg Watts Mensuel"
      unique_id: clim_salon_avg_watts_mensuel
      unit_of_measurement: "W"
      device_class: power
      state: >
        {% set conso = states('sensor.clim_salon_mensuel_kwh_um') | float(0) %}
        {% set hm = ((now().day - 1) * 24) + now().hour + (now().minute / 60) %}
        {{ ((conso * 1000) / hm if hm > 0.1 else 0) | round(1) }}

    # ┌───────────────────────────────────┐
    # │ 5. CUISINE                        │
    # └───────────────────────────────────┘
    # --- radiateur_cuisine_avg_watts_quotidien ---
    - name: "Radiateur Cuisine Avg Watts Quotidien"
      unique_id: radiateur_cuisine_avg_watts_quotidien
      unit_of_measurement: "W"
      device_class: power
      state: >
        {% set conso = states('sensor.radiateur_cuisine_quotidien_kwh_um') | float(0) %}
        {% set h = now().hour + (now().minute / 60) %}
        {{ ((conso * 1000) / h if h > 0.1 else 0) | round(1) }}

    # --- radiateur_cuisine_avg_watts_mensuel ---
    - name: "Radiateur Cuisine Avg Watts Mensuel"
      unique_id: radiateur_cuisine_avg_watts_mensuel
      unit_of_measurement: "W"
      device_class: power
      state: >
        {% set conso = states('sensor.radiateur_cuisine_mensuel_kwh_um') | float(0) %}
        {% set hm = ((now().day - 1) * 24) + now().hour + (now().minute / 60) %}
        {{ ((conso * 1000) / hm if hm > 0.1 else 0) | round(1) }}

    # ┌───────────────────────────────────┐
    # │ 7. BUREAU                         │
    # └───────────────────────────────────┘
    # --- clim_bureau_avg_watts_quotidien ---
    - name: "Clim Bureau Avg Watts Quotidien"
      unique_id: clim_bureau_avg_watts_quotidien
      unit_of_measurement: "W"
      device_class: power
      state: >
        {% set conso = states('sensor.clim_bureau_quotidien_kwh_um') | float(0) %}
        {% set h = now().hour + (now().minute / 60) %}
        {{ ((conso * 1000) / h if h > 0.1 else 0) | round(1) }}

    # --- clim_bureau_avg_watts_mensuel ---
    - name: "Clim Bureau Avg Watts Mensuel"
      unique_id: clim_bureau_avg_watts_mensuel
      unit_of_measurement: "W"
      device_class: power
      state: >
        {% set conso = states('sensor.clim_bureau_mensuel_kwh_um') | float(0) %}
        {% set hm = ((now().day - 1) * 24) + now().hour + (now().minute / 60) %}
        {{ ((conso * 1000) / hm if hm > 0.1 else 0) | round(1) }}

    # ┌───────────────────────────────────┐
    # │ 8. SDB                            │
    # └───────────────────────────────────┘
    # --- soufflant_sdb_avg_watts_quotidien ---
    - name: "Soufflant Sdb Avg Watts Quotidien"
      unique_id: soufflant_sdb_avg_watts_quotidien
      unit_of_measurement: "W"
      device_class: power
      state: >
        {% set conso = states('sensor.soufflant_sdb_quotidien_kwh_um') | float(0) %}
        {% set h = now().hour + (now().minute / 60) %}
        {{ ((conso * 1000) / h if h > 0.1 else 0) | round(1) }}

    # --- soufflant_sdb_avg_watts_mensuel ---
    - name: "Soufflant Sdb Avg Watts Mensuel"
      unique_id: soufflant_sdb_avg_watts_mensuel
      unit_of_measurement: "W"
      device_class: power
      state: >
        {% set conso = states('sensor.soufflant_sdb_mensuel_kwh_um') | float(0) %}
        {% set hm = ((now().day - 1) * 24) + now().hour + (now().minute / 60) %}
        {{ ((conso * 1000) / hm if hm > 0.1 else 0) | round(1) }}

    # --- seche_serv_avg_watts_quotidien ---
    - name: "Seche Serv Avg Watts Quotidien"
      unique_id: seche_serv_avg_watts_quotidien
      unit_of_measurement: "W"
      device_class: power
      state: >
        {% set conso = states('sensor.seche_serv_quotidien_kwh_um') | float(0) %}
        {% set h = now().hour + (now().minute / 60) %}
        {{ ((conso * 1000) / h if h > 0.1 else 0) | round(1) }}

    # --- seche_serv_avg_watts_mensuel ---
    - name: "Seche Serv Avg Watts Mensuel"
      unique_id: seche_serv_avg_watts_mensuel
      unit_of_measurement: "W"
      device_class: power
      state: >
        {% set conso = states('sensor.seche_serv_mensuel_kwh_um') | float(0) %}
        {% set hm = ((now().day - 1) * 24) + now().hour + (now().minute / 60) %}
        {{ ((conso * 1000) / hm if hm > 0.1 else 0) | round(1) }}

    # ┌───────────────────────────────────┐
    # │ 9. CHAMBRE                        │
    # └───────────────────────────────────┘
    # --- clim_chambre_avg_watts_quotidien ---
    - name: "Clim Chambre Avg Watts Quotidien"
      unique_id: clim_chambre_avg_watts_quotidien
      unit_of_measurement: "W"
      device_class: power
      state: >
        {% set conso = states('sensor.clim_chambre_quotidien_kwh_um') | float(0) %}
        {% set h = now().hour + (now().minute / 60) %}
        {{ ((conso * 1000) / h if h > 0.1 else 0) | round(1) }}

    # --- clim_chambre_avg_watts_mensuel ---
    - name: "Clim Chambre Avg Watts Mensuel"
      unique_id: clim_chambre_avg_watts_mensuel
      unit_of_measurement: "W"
      device_class: power
      state: >
        {% set conso = states('sensor.clim_chambre_mensuel_kwh_um') | float(0) %}
        {% set hm = ((now().day - 1) * 24) + now().hour + (now().minute / 60) %}
        {{ ((conso * 1000) / hm if hm > 0.1 else 0) | round(1) }}